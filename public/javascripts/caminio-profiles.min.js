/*! caminio-ui 2014-07-01 
* Copyright (c) 2014 TASTENWERK 
* Available via the MIT license.
* see: http://opensource.org/licenses/MIT for blueprint.
*/
(function(){"use strict";if("de"===currentLang){var a={"profile.my":"Mein Profil","profile.of":"Profil von","profile.change_password":"Kennwot ändern","profile.change_picture":"Profilbild ändern","profile.use_gravatar":"Gravatar verwenden","profile.stop_gravatar":"Gravatar nicht mehr verwenden","profile.avatar_saved":"Dein Profilbild wurde aktualisiert","profile.currently_using_gravatar":"Dein Bild wird momentan von http://gravatar.com bezogen","profile.change_lang":"Sprache","profile.lang_saved":'Deine Profilsprache ist nun "{{lang}}". Bitte lade die Seite neu, damit alle Änderungen wirksam werden',"profile.old_password":"Altes Passwort","profile.new_password":"Neues Passwort","profile.your_name":"Dein Name","profile.email":"Email","profile.phone":"Telefon","profile.your_saved":"Deine Profildaten wurden gespeichert","profile.saved":"Profil von {{name}} wurde gespeichert","profile.name_placeholder":"z.B.: Anna Muster","profile.will_be_exposed_to_others":"Der hier angegebene Name ist für andere Benutzer sichtbar","profile.password_saved":"Dein neues Passwort wurde gespeichert",missing_old_password:"Das alte Passwort stimmt nicht überein",password_criteria:"Dein neues Passwort muss mindestens 6 Zeichen, mind. eine Zahl, mind. einen Klein- und mind. einen Großbuchstaben beinhalten.","pic.change":"Dein Profilbild ändern"};for(var b in a)Em.I18n.translations[b]=a[b]}}).call(),function(){"use strict";if("en"===currentLang){var a={"profile.my":"My profile","profile.of":"Profile of {{name}}","profile.change_password":"Change password","profile.change_picture":"Change your picture","profile.use_gravatar":"Use Gravatar","profile.stop_gravatar":"Stop using Gravatar","profile.avatar_saved":"You avatar picture has been updated","profile.currently_using_gravatar":"Your avatar is linked to a the gravatar image of your email address on http://gravatar.com","profile.change_lang":"Language","profile.lang_saved":'Your profile language is now "{{lang}}". Please reload this page to make changes effect',"profile.old_password":"Old password","profile.new_password":"New password","profile.your_name":"Your name","profile.email":"Email","profile.phone":"Phone","profile.your_saved":"Your profile has been saved","profile.saved":"Profile of {{name}} has been saved","profile.name_placeholder":"e.g.: John Smith","profile.will_be_exposed_to_others":"This name will be exposed to other users","profile.password_saved":"Your new password has been saved",missing_old_password:"Old password does not match",password_criteria:"The password must have at least 6 characters, at least one digit, at least one uppercase and at least one lowercase character","pic.change":"Change your avatar picture","pic.drop_here":"Drop your picture here"};for(var b in a)Em.I18n.translations[b]=a[b]}}.call(),function(a){a.Router.map(function(){this.route("change_password",{path:"/passwd/:id"}),this.resource("index",{path:"/:id"})}),a.IndexRoute=Ember.Route.extend({model:function(a){return this.store.find("user",a.id)},actions:{changePassword:function(){this.render("password_modal",{into:"index",outlet:"modal"})},changePic:function(){this.render("pic_modal",{into:"index",outlet:"modal"})},closeModal:function(){this.disconnectOutlet({outlet:"modal",parentView:"index"})}}}),a.ChangePasswordRoute=a.IndexRoute.extend({model:function(a){return this.store.find("user",a.id)},setupController:function(a,b){this.set("indexCtrl",this.controllerFor("index")),this.get("indexCtrl").set("model",b)},renderTemplate:function(){this.render("index",{into:"application",controller:this.get("indexCtrl")}),this.render("password_modal",{into:"index",outlet:"modal"})}}),a.IndexController=Ember.ObjectController.extend({statName:function(a,b){var c=this.get("content");if(arguments.length>1){var d=b.split(/\s+/);c.set("firstname",d[0]),c.set("lastname",d[1])}return c.get("name")}.property(),actions:{save:function(){var a=this.get("model");a.save().then(function(){a.get("id")===currentUser._id?notify("info",Em.I18n.t("profile.your_saved")):notify("info",Em.I18n.t("profile.saved",{name:a.get("name")}))})},setLang:function(a){var b=this.get("model");b.set("lang",a),b.save().then(function(){notify("info",Em.I18n.t("profile.lang_saved",{lang:a}))})},useGravatar:function(){var a=this.get("model");if(a.get("remotePicUrl"))a.set("remotePicUrl",null);else{a.get("mediafiles").removeObject(a.get("mediafiles.firstObject"));var b=md5(a.get("email").toLowerCase());a.set("remotePicUrl","https://secure.gravatar.com/avatar/"+b+"?s=128")}a.save().then(function(){notify("info",Em.I18n.t("profile.avatar_saved"))})}}}),a.PasswordModalView=Ember.View.extend({didInsertElement:function(){this.$("#modal").modal().find("input[type=password]:first").focus()}}),a.PicModalView=Ember.View.extend({didInsertElement:function(){this.$("#modal").modal();var a=(this.get("controller"),this.get("controller.content"));this.$("#fileupload").fileupload({dataType:"json",dropZone:this.$(".title"),url:"/caminio/profile_pic",done:function(){setTimeout(function(){$("#progress").removeClass("active")},1e3),a.reload(),$(".top-panel img.avatar").attr("src","/caminio/profile_pics/"+a.get("id")+"?d="+moment().toDate().getTime().toString()),notify("info",Em.I18n.t("profile.avatar_saved")),$("#modal").modal("hide")},progressall:function(a,b){$("#progress").addClass("active");var c=parseInt(b.loaded/b.total*100,10);$("#progress .progress-bar").css("width",c+"%").attr("aria-valuenow",c).find(".perc-text").text(c+"%")}}).on("fileuploadsubmit",function(a,b){b.formData={only_one:!0}})}}),a.PasswordModalController=Ember.ObjectController.extend({needs:["index"],oldPassword:"",newPassword:"",oldPasswordError:!1,newPasswordError:!1,actions:{close:function(){$("#modal").modal("hide"),this.send("closeModal")},savePassword:function(){var a=this;this.set("oldPasswordError",!1),this.set("newPasswordError",!1);var b=this.get("controllers.index.content");return this.get("oldPassword")?this.get("newPassword")&&this.get("newPassword").match(/((?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,60})/)?void $.post("/caminio/accounts/"+b.get("id")+"/change_password",{oldPassword:this.get("oldPassword"),newPassword:this.get("newPassword")}).done(function(){notify("info",Em.I18n.t("profile.password_saved")),$("#modal").modal("hide"),a.send("closeModal"),a.set("oldPassword",""),a.set("newPassword","")}).fail(function(b,c,d){return"Forbidden"===d?a.set("oldPasswordError",!0):void 0}):this.set("newPasswordError",!0):this.set("oldPasswordError",!0)}}}),a.ApplicationView=Em.View.extend({didInsertElement:function(){setupCaminio(this.$())}})}(App);