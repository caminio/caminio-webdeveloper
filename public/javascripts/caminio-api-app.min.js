/*! caminio-ui 2014-07-01 
* Copyright (c) 2014 TASTENWERK 
* Available via the MIT license.
* see: http://opensource.org/licenses/MIT for blueprint.
*/
!function(){"use strict";function a(a){var b=a;if(!("translations"in a)||a.translations.length<1)return b;var c=a.translations.find(function(a){return a.locale===g.lang?a:void 0});c||(c=a.translations.find(function(a){return"en"===a.locale?a:void 0})),c||(c=a.translations[0]);for(var d in c)d.match(/title|subtitle|metaDescription|metaKeywords|categories/)&&(b[d]=c[d]),d.match(/content|aside/)&&(b[d]=c[d]?marked(c[d]):"");return b}function b(a,b,c){var d=a.mapBy("_id").join(",");$.getJSON(g.host+"/caminio/mediafiles",{parent:"in("+d+")"}).done(function(c){c.forEach(function(b){b.url=(g.fqdn?g.fqdn:g.host)+"/files/"+b.relPath;var c=a.findBy("_id",b.parent);c.mediafiles.pushObject(b),c.teaser=c.mediafiles.get("firstObject")}),b(a)}).fail(c)}function c(a){a.Select2CountryView=Ember.Select.extend({prompt:Em.I18n.t("select_country"),classNames:["input-xlarge"],willInsertElement:function(){var b=this;this.set("optionLabelPath","content.text"),this.set("optionValuePath","content.id");var c=$.ajax({url:"https://camin.io/caminio/util/countries?lang="+a.options.lang,crossDomain:!0,dataType:"json"});return c.done(function(c){var d=[];for(var e in c)d.push({id:e,text:c[e]});d.sort(function(a,b){return a.text.toLowerCase()<b.text.toLowerCase()?-1:a.text.toLowerCase()>b.text.toLowerCase()?1:a.text.toLowerCase()===b.text.toLowerCase()?0:void 0}),b.set("content",d),setTimeout(function(){b.get("value")?b.$().select2("val",b.get("value")):a.options.defaultCountry&&b.$().select2("val",a.options.defaultCountry)},100)}),c},didInsertElement:function(){Ember.run.scheduleOnce("afterRender",this,"processChildElements")},processChildElements:function(){this.$().select2()},willDestroyElement:function(){this.$().select2("destroy")},selectedDidChange:function(){var a=this;setTimeout(function(){a.get("value")&&a.$().select2("val",a.get("value"))},100)}.observes("value")})}var d,e,f,g={rootElement:"#caminio-api-root",lang:"en"},h=window.CaminioAPI=Ember.Namespace.create({VERSION:"1.0"});h.init=function(a){for(var b in a)g[b]=a[b];if(!g.apiKey)throw new Error("no apiKey option present");if(!g.host)throw new Error("no host option present");return CLDR.defaultLanguage=g.lang,d=Em.Application.create({rootElement:g.rootElement}),d.options=g,$.ajaxSetup({headers:{Authorization:"API-KEY "+g.apiKey}}),d.ApplicationRoute=Em.Route.extend({beforeModel:function(){function a(a,b){$.getJSON(g.host+"/caminio/accounts/mine").done(function(b){e=b,f=b.camDomains[0],a()}).fail(b)}return new Promise(a)}}),d.ApplicationView=Em.View.extend(),d.ApplicationController=Em.Controller.extend(),c(d),d};var i=Ember.Object.extend(Ember.Copyable,{init:function(){},copy:function(){return Em.run(this.constructor,"create",this.serialize())},serialize:function(){throw new Error(Ember.String.fmt("%@ has to implement serialize() method which is required to convert it to JSON.",[this]))}});i.reopenClass({storageKey:"_id",_cache:Em.A(),pushPayload:function(b){var c=this.create(a(b));return this._cache.pushObject(c),c}}),h.ShopOrder=i.extend({order_items:Em.A(),shop_customer:null}),h.OrderItem=i.extend({item:null,price:0,vat:0,amount:null,lineup_Entry:null}),h.LineupEntry=i.extend({title:null,curTranslation:function(){var a=this.get("translations").findBy("locale",h.lang);return a?a:this.get("translations.firstObject")}.property("translations"),venue:function(){return this.get("lineup_events.firstObject.lineup_org")}.property("lineup_events"),coach:function(){return this.get("lineup_jobs.firstObject.lineup_person")}.property("lineup_jobs"),serialize:function(){return this.getProperties(["id","title"])}}),h.LineupEntry.find=function(a,b){function c(c,d){$.getJSON(g.host+"/caminio/lineup_entries/events",b).then(function(b){return"string"==typeof a?c(h.LineupEntry.pushPayload(b.find(function(b){return b._id===a}))):void c(Ember.A(b.map(function(a){return h.LineupEntry.pushPayload(a)})))}).fail(function(){d()})}function d(b){return new Promise(function(c,d){if(!b)return c();b=b instanceof Array?b:[b];var e=[],f=[];b.forEach(function(a){e.push(a.get("lineup_jobs.firstObject.lineup_person._id")),f.push(a.get("_id"))}),$.getJSON(g.host+"/caminio/mediafiles",{parent:"in("+e.join(",")+")"}).done(function(d){d.forEach(function(a){a.url=(g.fqdn?g.fqdn:g.host)+"/files/"+a.relPath;var c=b.findBy("_id",f[e.indexOf(a.parent)]);c.set("coachPic",a)}),c("string"==typeof a?b[0]:b)}).fail(d)})}"object"==typeof a&&(b=a),b=b||{};var e=new Promise(c);return e=e.then(d)},h.ShopItem=i.extend({title:null,init:function(){this.set("mediafiles",Em.A())},serialize:function(){return this.getProperties(["id","title"])}}),h.ShopItem.reopenClass({getCategories:function(){var a=Em.A();return this._cache.forEach(function(b){b.get("categories")&&b.get("categories").forEach(function(b){var c=a.findBy("name",b);return c?c.count+=1:void a.pushObject({name:b,count:1})})}),a}}),h.ShopItem.find=function(a,c){function d(d,e){function f(b){return a&&"string"==typeof a?d(b[0]):void d(b)}$.getJSON(g.host+"/caminio/shop_items",c).then(function(a){a=Ember.A(a.map(function(a){return h.ShopItem.pushPayload(a)})),b(a,f,e)}).fail(function(){e()})}if("object"==typeof a&&(c=a),c=c||{},"string"==typeof a&&this._cache.get("length")>0)return this._cache.findBy("_id",a);var e={status:"published"};for(var f in e)c[f]=e[f];return new Promise(d)}}();