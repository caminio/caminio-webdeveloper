/*! caminio-shop 2014-07-01 
* Copyright (c) 2014 TASTENWERK 
* Available via the MIT license.
* see: http://opensource.org/licenses/MIT for blueprint.
*/
!function(a){"use strict";a.OrderItem=DS.Model.extend({amount:DS.attr("number"),priceValue:DS.attr("number"),priceName:DS.attr("string"),selPrice:DS.belongsTo("price"),price:DS.belongsTo("price",{embedded:"keys"}),item:DS.belongsTo("shop_item"),shippedAt:DS.attr("date"),shippedBy:DS.belongsTo("user"),createdAt:DS.attr("date"),createdBy:DS.belongsTo("user"),updatedAt:DS.attr("date"),updatedBy:DS.belongsTo("user"),updatePrice:function(){var a=this.get("price");a&&(this.set("priceValue",a.get("price")),this.set("priceName",a.get("name")))}.observes("price.price"),priceExcl:function(){var a=isNaN(this.get("priceValue"))?0:parseFloat(this.get("priceValue"));return a.toFixed(2)}.property("priceValue"),priceIncl:function(){var b=isNaN(this.get("priceValue"))?0:parseFloat(this.get("priceValue"));isNaN(b)&&(b=0);var c=isNaN(a._shopSettings.get("vat"))?0:parseFloat(a._shopSettings.get("vat"));return(b+b*c*.01).toFixed(2)}.property("priceValue"),formattedPrice:function(){var b=this.get(a._shopSettings.get("grossInt")?"priceIncl":"priceExcl");return isNaN(b)&&(b=0),b=b.toString(),"de"===currentUser.lang&&(b=b.replace(".",",")),new Handlebars.SafeString(b+" "+caminio.util.currencyCode2Symbol(a._shopSettings.get("currency")))}.property("price"),formattedPriceTotal:function(){var b=this.get(a._shopSettings.get("grossInt")?"priceIncl":"priceExcl");return b*=this.get("amount")||0,b=b.toFixed(2),"de"===currentUser.lang&&(b=b.replace(".",",")),new Handlebars.SafeString(b+" "+caminio.util.currencyCode2Symbol(a._shopSettings.get("currency")))}.property("price","amount")}),Ember.Inflector.inflector.irregular("orderItem","order_items")}(App),function(a){"use strict";function b(a){return"de"===currentDomain.defaultLang?a.replace(".",","):a}a.Price=DS.Model.extend({name:DS.attr("string"),description:DS.attr("string"),note:DS.attr("string"),limited:DS.attr("number"),price:DS.attr("number"),reductions:DS.hasMany("reduction",{embedded:"always"}),vat:DS.attr("number"),priceIncl:function(){var a=isNaN(this.get("price"))?0:parseFloat(this.get("price")),b=this.get("vat");return(a+a*b*.01).toFixed(2)}.property("vat","price"),priceExcl:function(){var a=isNaN(this.get("price"))?0:parseFloat(this.get("price"));return a.toFixed(2)}.property("vat","price"),formattedPrice:function(){var c=this.get(a._shopSettings.get("grossInt")?"priceIncl":"priceExcl");return new Handlebars.SafeString(b(c)+" "+caminio.util.currencyCode2Symbol(a._shopSettings.get("currency")))}.property("price"),compatiblePrice:function(c,d){if(d=d?parseFloat(d.replace(",",".")):null,a.get("_shopSettings.grossInt")){if(d){var e=isNaN(d)?0:d,f=this.get("vat"),g=e/(100+f),h=100*g;this.set("price",h.toFixed(2))}return b(this.get("priceIncl"))}return d&&this.set("price",d),b(this.get("price"))}.property("price")}),a.Reduction=a.Price.extend()}(App),function(a){"use strict";a.ShopCustomer=DS.Model.extend({customerId:DS.attr("number"),firstname:DS.attr("string"),lastname:DS.attr("string"),title:DS.attr("string"),gender:DS.attr("string"),organization:DS.attr("string"),shipFirstname:DS.attr("string"),shipLastname:DS.attr("string"),shipOrganization:DS.attr("string"),shipStreet:DS.attr("string"),shipZip:DS.attr("string"),shipCity:DS.attr("string"),shipCountry:DS.attr("string"),shipState:DS.attr("string"),billOrganization:DS.attr("string"),billFirstname:DS.attr("string"),billLastname:DS.attr("string"),billStreet:DS.attr("string"),billZip:DS.attr("string"),billCity:DS.attr("string"),billCountry:DS.attr("string"),billState:DS.attr("string"),phone:DS.attr("string"),email:DS.attr("string"),useOrigName:DS.attr("boolean",{defaultValue:!0}),useShipForBill:DS.attr("boolean",{defaultValue:!0}),name:function(){return this.get("firstname")+" "+this.get("lastname")}.property("firstname","lastname"),updateShipBillNames:function(){this.get("useOrigName")&&(this.set("shipFirstname",this.get("firstname")),this.set("shipLastname",this.get("lastname")),this.set("shipOrganization",this.get("organization"))),this.get("useShipForBill")&&this.get("useOrigName")&&(this.set("billFirstname",this.get("firstname")),this.set("billLastname",this.get("lastname")),this.set("billOrganization",this.get("organization")))}.observes("firstname","lastname","organization"),updateBillAddr:function(){this.get("useShippingAddress")&&(this.set("billStreet",this.get("shippingStreet")),this.set("billZip",this.get("shippinZip")),this.set("billCity",this.get("shippingCity")),this.set("billCountry",this.get("shippingCountry")),this.set("billState",this.get("shippingState")))}.observes("shipStreet","shipZip","shipCity","shipCountry","shipState"),checkNewUsers:function(){if(this.get("isNew")){var b={};this.get("firstname")&&(b.firstname="regexp(/"+this.get("firstname")+"/i)"),this.get("lastname")&&(b.lastname="regexp(/"+this.get("lastname")+"/i)"),this.get("organization")&&(b.organization="regexp(/"+this.get("organization")+"/i)"),this.store.find("shop_customer",b).then(function(b){b.get("length")<1&&a._suggestedCustomers.clear(),b.forEach(function(b){a._suggestedCustomers.findBy("id",b.get("id"))||a._suggestedCustomers.pushObject(b),$("#auto-suggestions li").effect("highlight",{},500)})})}}.observes("firstname","lastname","email","organization")}),Ember.Inflector.inflector.irregular("shopCustomer","shop_customers")}(App),function(a){"use strict";a.ShopItem=DS.Model.extend({prices:DS.hasMany("price",{embedded:"always"}),status:DS.attr("string",{defaultValue:"draft"}),translations:DS.hasMany("translation",{embedded:"always"}),orders:DS.hasMany("shop_order"),quota:DS.attr("number",{defaultValue:0}),unlimited:DS.attr("boolean",{defaultValue:!1}),currency:DS.attr("string"),vat:DS.attr("number"),description:DS.attr("string"),published:DS.attr("boolean"),num:DS.attr("string"),isEmptyStock:function(){return this.get("quota")<1&&!this.get("unlimited")?!0:!1}.property("quota"),categoryLabels:function(){return new Handlebars.SafeString(this.get("curTranslation.categories").toArray().map(function(a){return'<span class="label label-primary">'+a+"</span>"}).join("\n"))}.property("curTranslation.categories.@each"),priceRange:function(){var a,b;return this.get("prices").forEach(function(c){(!a||c.get("price")<=a)&&(a=c.get("price")),(!b||c.get("price")>=b)&&(b=c.get("price"))}),[a,b]}.property("prices"),formattedPrice:function(){return this.get("prices.firstObject.formattedPrice")}.property("prices"),isPublished:function(){return"published"===this.get("status")}.property("status"),inReview:function(){return"review"===this.get("status")}.property("status"),isDraft:function(){return"draft"===this.get("status")}.property("status"),curTranslation:function(){return this.get("translations").findBy("locale",a._curLang)}.property("translations.@each","App._curLang"),previewLink:function(){var a="http://"+currentDomain.fqdn+"/drafts/"+this.get("id")+".htm";return this.get("translations").content.length>1&&(a+="."+this.get("curLang")),a}.property("id"),unlimitedObserver:function(){this.get("unlimited")&&this.set("quota",0)}.observes("unlimited"),priceObserver:function(){0===this.get("quota")?this.set("unlimited",!0):this.set("unlimited",!1)}.observes("quota")}),Ember.Inflector.inflector.irregular("shopItem","shop_items")}(App),function(a){"use strict";a.ShopOrder=DS.Model.extend({num:DS.attr("string"),shop_customer:DS.belongsTo("shop_customer"),isShipped:function(){return this.get("shippedAt")&&moment(this.get("shippedAt")).isValid()}.property("order_items"),order_items:DS.hasMany("order_item",{embedded:"always",key:"order_items"}),isPaid:function(){return this.get("paidAt")&&moment(this.get("paidAt")).isValid()}.property("paidAt"),isConfirmed:function(){return this.get("confirmedAt")&&moment(this.get("confirmedAt")).isValid()}.property("confirmedAt"),paidButNotShipped:function(){return this.get("isPaid")&&!this.get("isShipped")}.property("paidAt","shippedAt"),paidAt:DS.attr("date"),paymentMethod:DS.attr("string"),paidAnnotation:DS.attr("string"),markedPaidBy:DS.belongsTo("user"),confirmedAt:DS.attr("date",{defaultValue:function(){return moment().toDate()}}),confirmedIp:DS.attr("string"),confirmedUser:DS.attr("string",{defaultValue:currentUser._id}),confirmedUserName:function(){var b=a.User.store.getById("user",this.get("confirmedUser"));return b.get("name")}.property("confirmedUser"),formattedPriceTotal:function(){var b=0;return this.get("order_items").forEach(function(c){var d=c.get(a._shopSettings.get("grossInt")?"priceIncl":"priceExcl");b+=d*c.get("amount")}),b=b.toFixed(2),"de"===currentUser.lang&&(b=b.replace(".",",")),new Handlebars.SafeString(b+" "+caminio.util.currencyCode2Symbol(a._shopSettings.get("currency")))}.property("order_items.[].priceValue"),totalAmount:function(){var a=0;return this.get("order_items").forEach(function(b){a+=b.get("amount")}),a}.property("order_items.[].amount"),categories:function(){var a={};return this.get("order_items").forEach(function(b){a[b.get("priceName")]=a[b.get("priceName")]||0,a[b.get("priceName")]+=b.get("amount")}),new Handlebars.SafeString(Object.keys(a).map(function(b){return a[b]+"x "+b}).join("<br>"))}.property("order_items.[].priceName"),createdAt:DS.attr("date"),createdBy:DS.belongsTo("user"),updatedAt:DS.attr("date"),updatedBy:DS.belongsTo("user")}),Ember.Inflector.inflector.irregular("shopOrder","shop_orders")}(App),function(){"use strict";App.ShopSetting=DS.Model.extend({name:DS.attr("string"),webPath:DS.attr("string"),description:DS.attr("string"),currency:DS.attr("string"),grossInt:DS.attr("boolean"),grossExt:DS.attr("boolean"),bcc:DS.attr(),notifyCustomerOnShippmentChecked:DS.attr("boolean"),vat:DS.attr("number"),psp:DS.attr(),pspApiKey:DS.attr()}),Ember.Inflector.inflector.irregular("shopSetting","shop_settings")}(App);