/*! caminio-ui 2014-07-01 
* Copyright (c) 2014 TASTENWERK 
* Available via the MIT license.
* see: http://opensource.org/licenses/MIT for blueprint.
*/
!function(){"use strict";if("de"===currentLang){var a={"nav.users":"Benutzerkonten","nav.domains":"Domänen","nav.settings":"Einstellungen",unknown:"Unbekannt","users.import_csv":"Benutzerkonten von CSV importieren","user.name":"Name","user.save":"Speichern","user.created":"{{name}} wurde erfolgreich gespeichert","user.saved":"{{name}} wurde gespeichert","user.create":"Konto erstellen","user.new":"Neues Benutzerkonto","user.edit":"BenutzerIn bearbeiten","user.email":"Email","user.phone":"Telefon","user.firstname":"Vorname","user.lastname":"Nachname","user.tabs.general":"Allgemein","user.tabs.settings":"Einstellungen","user.tabs.history":"Protokoll","user.send_login_info":"Login Informationen noch einmal schicken","user.sent_credentials_again":"Login Information wurden erfolgreich versandt","user.api_gen_failed":"API Schlüsselerzeugung fehlgeschlagen. Bitte nochmal probieren","user.convert_api_user":"API Konto konvertieren","user.api_key_generated":"API Schlüssel wurde für {{name}} erzeugt","user.api_key":"API Schlüssel","user.api_role_not_allowed":"Rolle nicht erlaubt für API Konten","user.converted_into_api":"{{name}} ist jetzt ein API Konto","user.converted_back":"{{name}} ist jetzt ein reguläres Konto","user.password":"Passwort","user.password_confirmation":"Wiederholen","user.admin":"AdministratorIn","user.editor":"RedakteurIn","user.api.enabled":"aktiviert","user.api.disabled":"deaktiviert","user.access_rights":"Zugriffsrechte","user.roles.no_access":"Kein Zugriff","user.roles.comments_only":"Nur kommentieren","user.roles.default":"Standard","user.roles.editor":"Redaktion","user.roles.trustee":"Vertrauliche Redaktion","user.roles.admin":"Administration","user.lang":"Sprache","user.photo":"Photo","user.danger":"Gefahrenzone","user.errors.prohibited_save":"Mindestens ein Fehler hinderte das Formular gespeichert zu werden","user.security":"Sicherheit","user.api":"API","user.remote_clients":"Fernzugriffe","user.cannot_delete_domain_owner":"Das Domänenadministrationskonto kann nicht gelöscht werden!","user.remove_desc":"Wenn dieses Benutzerkonto gelöscht wird, werden alle Kommentare und Nachrichten, die von diesem Konto aus erstellt wurden, ebenfalls gelöscht. Webseiten und andere geteilte Inhalte werden anulliert; die Besitzerschaft auf den Domänenadministrator übertragen","user.remove":"Dieses Benutzerkonto löschen","user.really_delete":"Dieses Benutzerkonto wirklich löschen? Diese Aktion kann nicht rückgängig gemacht werden. Um fortzufahren, gib den vollen Namen des Benutzerkontos <strong>{{fullname}}</strong> in das Feld unterhalb ein","user.removed":"Das Benutzerkonto {{name}} wurde gelöscht","user.really_remove_from_domain":"Das Benutzerkonto {{fullname}} von dieser Domäne entfernen?","user.removed_from_domain":"Das Benutzerkonto {{fullname}} wurde von dieser Domäne entfernt","user.notify_settings":"Einstellungen","user.notifications":"Benachrichtigungen",invalid_email:"Die Emailadresse {{value}} ist ungültig","domain.name":"Name","domain.settings":"Einstellungen","domain.owner":"Besitzer","domain.fqdn":"FQDN","domain.remote_addr":"Entfernter Server Adresse","domain.remote_user":"Entfernter Server Login","domain.remote_pass":"Entfernter Server Passwort","domain.new":"Neue Domäne","domain.edit":"Domäne bearbeiten","domain.save":"Domäne speichern","domain.saved":"{{name}} wurde gespeichert","domain.created":"{{name}} wurde erfolgreich erstellt","domain.allowed_apps":"Erlaubte Anwendungen","domain.default_lang":"Standardsprache für Benutzerkonten","domain.default_country":"Immmer Land vorauswählen","domain.currency":"Standardwährung für Webshop","domain.vat":"MwSt %","domain.available_langs":"Verfügbare Sprachen","domain.is_caminio_hosted":"Domain wird auf caminio bereitgestellt","domain.thumbs":"Thumbnailgrößen","domain.danger":"Gefahrenzone","domain.remove":"Diese Domäne löschen","domain.remove_desc":"Wenn du diese Domäne löscht, werden alle Benutzerkonten und Daten unwiderruflich gelöscht.","domain.removed":"Domäne {{name}} wurde gelöscht","domain.really_delete":"Möchtest du die Domäne {{name}} unwiderruflich löschen? Um fortzufahren, gib bitte den Namen der Domäne <strong>{{name}}</strong> hier ein","domain.disk_quota_m":"Festplatten Quota (MB)","domain.upload_limit_m":"Upload limit (MB)","domain.user_quota":"Benutzerkonten Quota","domain.switch":"Auf diese Domäne wechseln","domain.description":"Beschreibung","domain.create":"Domäne erstellen","errors.invalid_domain_name":"Ungültiger Domänenname","errors.already_member":"Die angegebene Email Adresse ist bereits Mitglied dieser Domäne","client.create":"Neuen API Key erstellen","client.saved":"API Key {{name}} wurde gespeichert","client.really_delete":"Soll {{name}} wirklich gelöscht werden? Das könnte negative Auswirkungen auf andere Seiten haben","client.removed":"{{name}} wurde gelöscht","client.domain":"Domäne","client.name":"Domänenname","client.id":"Consumer key","client.secret":"Consumer secret"};for(var b in a)Em.I18n.translations[b]=a[b]}}(),function(){"use strict";if("en"===currentLang){var a={"nav.users":"Users","nav.domains":"Domains","nav.settings":"Settings",unknown:"Unknown","users.import_csv":"Import users from csv file","user.name":"Name","user.save":"Save","user.created":"User {{name}} has been created successfully","user.saved":"User {{name}} has been saved","user.create":"Create","user.new":"Create new user","user.edit":"Edit user","user.email":"Email","user.phone":"Phone","user.firstname":"Firstname","user.lastname":"Lastname","user.tabs.general":"General","user.tabs.settings":"Settings","user.tabs.history":"History","user.send_login_info":"Send login info again","user.sent_credentials_again":"Login credentials have been sent successfully","user.api_gen_failed":"API generation failed. Please try again","user.convert_api_user":"Convert into API account","user.api_key_generated":"API key has been generated for {{name}}","user.api_key":"API key","user.api_role_not_allowed":"Role not allowed for API accounts","user.converted_into_api":"User {{name}} is now an API user","user.converted_back":"User {{name}} is no longer an API user","user.password":"Password","user.password_confirmation":"Repeat password","user.admin":"Administrator","user.editor":"Editor","user.api.enabled":"enabled","user.api.disabled":"disabled","user.access_rights":"Access rights","user.roles.no_access":"no access","user.roles.comments_only":"comments only","user.roles.default":"default","user.roles.editor":"editor","user.roles.trustee":"trustee","user.roles.admin":"administrator","user.lang":"Language","user.photo":"Photo","user.danger":"Danger zone","user.api":"API","user.remote_clients":"Remote clients","user.cannot_delete_domain_owner":"The domain administration account cannot be deleted!","user.remove_desc":"If you remove this account, all comments will be removed, all items shared with others will be nullified (ownership will be set to the domain owner","user.remove":"Remove this user account","user.really_delete":"Really delete this user? This action cannot be undone. Please type the user's name <strong>{{fullname}}</strong> into the field below to continue.","user.really_remove_from_domain":"Really remove user {{fullname}} from this domain?","user.removed_from_domain":"The user account {{fullname}} has been removed from this domain","user.removed":"User {{name}} has been removed","user.notify_settings":"Settings","user.notifications":"Notifications","user.errors.prohibited_save":"Errors prohibited this form to be saved","user.security":"Security",invalid_email:"The email address entered is not valid: {{value}}",required_fields:"Required fields","domain.name":"Domain name","domain.settings":"Settings","domain.owner":"Owner","domain.fqdn":"FQDN","domain.remote_addr":"Remote address","domain.remote_user":"Remote username","domain.remote_pass":"Remote password","domain.new":"New domain","domain.edit":"Edit domain","domain.save":"Save domain","domain.saved":"Domain {{name}} has been saved","domain.created":"Domain {{name}} has been created successfully","domain.allowed_apps":"Allowed applications","domain.default_lang":"Default language for users","domain.default_country":"Always select country","domain.available_langs":"Available languages","domain.is_caminio_hosted":"Domain is hosted on caminio","domain.currency":"Default currency for webshop","domain.vat":"VAT %","domain.thumbs":"Thumbnail sizes","domain.disk_quota_m":"Disk quota (MB)","domain.upload_limit_m":"Upload size limit (MB)","domain.user_quota":"Users quota","domain.danger":"Danger zone","domain.remove":"Remove this domain","domain.remove_desc":"Removing this domain will delete all useres and all data permanently. There is no way to undo this action","domain.removed":"Domain {{name}} has been removed","domain.really_delete":"Do you really want to delete this domain including all user accounts? Enter the domain name {{name}} to proceed","domain.switch":"Switch to this domain","domain.description":"Description","domain.create":"Create domain","errors.invalid_domain_name":"The entered value is not a valid domain name","errors.already_member":"The chosen email address is already member of this domain","client.create":"Add new client id","client.saved":"Client {{name}} has been saved","client.really_delete":"Really delete client {{name}}? This might have unexpected impact on other sites accessing through this client","client.removed":"{{name}} has been removed","client.domain":"Domain name","client.name":"Domain name","client.id":"Consumer key","client.secret":"Consumer secret"};for(var b in a)Em.I18n.translations[b]=a[b]}}(),function(a){"use strict";a.Enums={},a.Enums.availableAppNames=["dashboard","admin","people","shop","lineup","rocksol","calendar","projects","social-networks"],a.Router.map(function(){this.resource("domains",{path:"/domains"},function(){this.route("new"),this.resource("domain.edit",{path:"/:id"})}),this.resource("settings"),this.resource("users",{path:"/users"},function(){this.route("new"),this.resource("user.edit",{path:"/:id"})})}),a.DomainsIndexRoute=Ember.Route.extend({setupController:function(a){a.set("domains",this.store.find("domain"))}}),a.SettingsRoute=Ember.Route.extend({setupController:function(a){this.store.getById("domain",currentDomain._id)?a.set("domain",this.store.getById("domain",currentDomain._id)):this.store.find("domain",{_id:currentDomain._id}).then(function(b){a.set("domain",b.content[0]),$("#domain-settings").val(JSON.stringify(a.get("domain.preferences"),null,2))})}}),a.DomainsNewRoute=Ember.Route.extend({setupController:function(a){var b=this.store.createRecord("user",{admin:!0});a.set("user",b),a.set("domain",this.store.createRecord("domain",{user:b}))},actions:{create:function(a){var b=this;a.save().then(function(){b.transitionTo("domains"),notify("info",Ember.I18n.t("domain.created",{name:a.get("name")}))}).catch(function(b){console.error(b);var c=b.responseJSON.errors;for(var d in c)c[d]=Ember.I18n.t("errors."+c[d]);a.set("errors",c),notify.processError(b.responseJSON)})}}}),a.DomainEditRoute=Ember.Route.extend({model:function(a,b){return this.store.find("domain",b.params.id)},setupController:function(a,b){a.set("domain",this.store.find("domain",b.id))},actions:{save:function(){var a=this,b=this.get("controller.domain.content");b.save().then(function(){a.transitionTo("domains"),notify("info",Ember.I18n.t("domain.saved",{name:b.get("name")}))}).catch(function(a){notify.processError(a.responseJSON)})}}}),a.UsersIndexRoute=Ember.Route.extend({setupController:function(a){a.set("users",this.store.find("user"))}}),a.UserEditRoute=Ember.Route.extend({model:function(a,b){var c=this.store.find("user",b.params.id);return c}}),a.UsersNewRoute=Ember.Route.extend({model:function(){var a={};a[currentDomain._id]=40;var b=this.store.createRecord("user",{roles:a});return b}}),a.IndexRoute=Ember.Route.extend({redirect:function(){this.transitionTo("users")}}),a.ApplicationController=Ember.Controller.extend({isSuperUser:function(){return currentUser.superuser}.property()}),a.ApplicationRoute=Ember.Route.extend({actions:{goToUsers:function(){this.transitionTo("users")},goToUser:function(a){this.transitionTo("user.edit",a)},goToDomains:function(){this.transitionTo("domains")},goToDomain:function(a){this.transitionTo("domain.edit",a)},switchDomainId:function(a){location.href="/caminio/admin?camDomainId="+a.get("id")},edit:function(a){this.transitionTo("user.edit",a.copy())},importCSV:function(){bootbox.dialog({title:Em.I18n.t("users.import_csv"),message:'<form action="/caminio/usersexchange/import.csv" method="post" enctype="multipart/form-data"><input type="file" name="csv_file"></form>',buttons:{upload:{label:"upload",className:"primary",callback:function(a){var b=$(a.target).closest(".modal").find("form");b.slideUp(),b.after('<div class="progress progress-striped active"><div class="progress-bar"  role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"><span class="sr-only">processing import</span></div></div>'),b.submit()}}}})},cancel:function(b){Ember.run(b,"destroy"),this.store.refresh(a.User),this.transitionTo("users")}}}),a.ApplicationView=Em.View.extend({didInsertElement:function(){setupCaminio(this.$())}})}(App),function(a){"use strict";a.Domain=DS.Model.extend({name:DS.attr("string"),fqdn:DS.attr("string"),description:DS.attr("string"),preferences:DS.attr("object"),custom:DS.attr("object"),lang:DS.attr("string",{defaultValue:"de"}),diskQuotaM:DS.attr("number"),isCaminioHosted:DS.attr("boolean",{defaultValue:!0}),remoteAddr:DS.attr("string"),remoteUser:DS.attr("string"),remotePass:DS.attr("string"),diskUploadLimitM:DS.attr("number"),usersQuota:DS.attr("number"),allowedAppNames:DS.attr("array"),user:DS.belongsTo("user",{embedded:"always"}),availableLangs:function(a,b){if(arguments.length<2)return this.get("preferences.availableLangs");var c=this.get("preferences");c&&(c.availableLangs=b.split(",").replace(/\ /g,""),this.set("preferences",c))}.property("preferences"),thumbs:function(a,b){if(arguments.length<2)return this.get("preferences.thumbs");var c=this.get("preferences");c&&(c.thumbs=b.split(",").replace(/\ /g,""),this.set("preferences",c))}.property("preferences")})}(App),$(function(){"use strict";var a={emailError:function(){return this.get("errors")?"email"in this.get("errors"):void 0}.property("errors"),nameError:function(){return this.get("errors")?"name"in this.get("errors"):void 0}.property("errors"),availableAppNames:function(){return[{id:"contacts",text:"contacts"},{id:"admin",text:"admin"}]}.property(),languages:function(){return App.get("_availableLanguages")}.property(),isWebshopEnabled:function(){return this.get("domain.allowedAppNames").indexOf("shop")>=0}.property("domain.allowedAppNames"),actions:{removeDomain:function(a){a=a instanceof DS.PromiseObject?a.content:a;var b=this;bootbox.prompt(Em.I18n.t("domain.really_delete",{name:a.get("name")}),function(c){c===a.get("name")&&(a.deleteRecord(),a.save().then(function(){notify("info",Em.I18n.t("domain.removed",{name:a.get("name")})),b.transitionToRoute("domains")}))})}}};App.DomainEditController=Ember.Controller.extend(a),App.DomainsNewController=Ember.Controller.extend(a),App.DomainsController=Ember.Controller.extend(a)}),function(a){"use strict";a.SettingsController=Ember.Controller.extend({actions:{saveSettings:function(a){try{a.set("preferences",JSON.parse($("#domain-settings").val())),a.save().then(function(){notify("info",Em.I18n.t("domain.saved",{name:a.get("name")}))})}catch(b){console.error(b),notify("error","json parse error")}}}}),a.SettingsView=Ember.View.extend({didInsertElement:function(){this.get("controller.domain")&&$("#domain-settings").val(JSON.stringify(this.get("controller.domain.preferences"),null,2))}})}(App),function(a){"use strict";function b(b,c){a.User.store.createRecord("client",{user:b.get("id")});c.set("apiClients",a.User.store.all("client",{user:b.get("id")}))}var c={emailError:function(){return this.get("errors")?"email"in this.get("errors"):void 0}.property("errors"),actions:{sendLoginAgain:function(a){$.post("/caminio/accounts/"+a.get("id")+"/resend_credentials",{}).done(function(a){a.user&&notify("info",Em.I18n.t("user.sent_credentials_again"))})},genApiKey:function(){var a=this.get("model");$.post("/caminio/accounts/"+this.get("model.id")+"/gen_api_key").done(function(b){b&&b.apiKey&&(a.set("apiKey",b.apiKey),a.set("apiEnabled",!0)),a.save().then(function(){notify("info",Em.I18n.t("user.api_key_generated"))})}).fail(function(){notify("error",Em.I18n.t("user.api_gen_failed"))})},toggleAPI:function(){return"undefined"==typeof this.get("model.apiEnabled")&&this.get("model").set("apiEnabled",!1),this.get("model").set("apiEnabled",!this.get("apiEnabled")),this.get("model.apiEnabled")?(this.send("genApiKey"),void(this.get("model.apiEnabled")&&this.get("apiClients").content.content.length<1&&b(this.get("model"),this))):this.set("model.apiKey",null)},create:function(a){var b=this;a.save().then(function(){b.transitionToRoute("users"),notify("info",Ember.I18n.t("user.created",{name:a.get("fullname")}))}).catch(function(b){var c=b.responseJSON.errors;for(var d in c)c[d]=Ember.I18n.t("errors."+c[d]);a.set("errors",c),notify.processError(b.responseJSON)})},update:function(a){var b=this;a.save().then(function(){b.transitionTo("users"),notify("info",Ember.I18n.t("user.saved",{name:a.get("fullname")}))}).catch(function(a){notify.processError(a.responseJSON)})},addClient:function(a){b(a,this),setTimeout(function(){$(".client-name:last").focus()},10)},convertIntoApi:function(a){var b=this;if(a.set("apiUser",!a.get("apiUser")),a.get("apiUser")){var c=(new Date).getTime().toString(36)+2*(new Date).getTime()+(new Date).getTime().toString(36).toUpperCase();return a.set("password",c),a.set("passwordConfirmation",c),void a.save().then(function(){notify("info",Em.I18n.t("user.converted_into_api",{name:a.get("name")})),b.send("genApiKey")})}a.save().then(function(){notify("info",Em.I18n.t("user.converted_back",{name:a.get("name")}))})},removeUser:function(){var a=this.get("model"),b=this;return a.get("id")===currentDomain.owner?bootbox.alert(Em.I18n.t("user.cannot_delete_domain_owner")):void(a.get("camDomains").length>1?bootbox.confirm(Em.I18n.t("user.really_remove_from_domain",{fullname:a.get("fullname")}),function(c){c&&a.destroyRecord().then(function(){notify("info",Em.I18n.t("user.removed_from_domain",{fullname:a.get("fullname")})),b.transitionToRoute("users")}).catch(function(a){notify.processError(a)})}):bootbox.prompt(Em.I18n.t("user.really_delete",{fullname:a.get("fullname")}),function(c){c===a.get("fullname")&&(a.deleteRecord(),a.save().then(function(){notify("info",Em.I18n.t("user.removed",{name:a.get("fullname")})),b.transitionToRoute("users")}))}))}}};a.UsersController=Ember.Controller.extend(c),a.UserEditController=Ember.ObjectController.extend(c),a.UsersNewController=Ember.ObjectController.extend(c),a.ClientController=Ember.Controller.extend({actions:{saveClient:function(){var a=this.get("content");this.get("parentController.model").set("apiEnabled",!0),this.get("parentController.model").save(),a.save().then(function(){notify("info",Em.I18n.t("client.saved",{name:a.get("name")}))})},removeClient:function(){var a=this.get("content"),b=this;bootbox.confirm(Em.I18n.t("client.really_delete",{name:a.get("name")}),function(c){c&&(a.deleteRecord(),a.save().then(function(){notify("info",Em.I18n.t("client.removed",{name:a.get("name")})),b.get("parentController").set("apiClients",b.get("parentController").store.all("client",{user:b.get("parentController.model.id")}))}))})}}})}(App),function(a){"use strict";a.UserEditView=Ember.View.extend({didInsertElement:function(){var a=this.get("controller");this.get("controller.model.id")&&this.get("controller").set("apiClients",this.get("controller.store").find("client",{user:this.get("controller.model.id")})),this.$("#role-slider").slider({tooltip:"hide",min:0,max:100,step:20,value:a.get("currentDomainRole")}).on("slideStop",function(b){a.get("content").set("currentDomainRole",b.value)})}}),a.UsersNewView=a.UserEditView.extend()}(App);