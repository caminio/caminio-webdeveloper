/*! caminio-ui 2014-07-01 
* Copyright (c) 2014 TASTENWERK 
* Available via the MIT license.
* see: http://opensource.org/licenses/MIT for blueprint.
*/
!function(a){"use strict";function b(a){var b='<form class="bootbox-form"><div class="form-group row"><input type="text" value="'+(a.get("name")||"")+'" autocomplete="off" class="bootbox-input bootbox-input-text form-control name col-md-12"></div><div class="row margin-top clearfix colors"><label class="control-label col-md-3">'+Em.I18n.t("label.select_color")+'</label><div class="col-md-9">'+caminio.labels.getColors()+'</div></div><div class="row margin-top clearfix colors"><label class="control-label col-md-3">'+Em.I18n.t("label.private")+'</label><div class="col-md-9"><input type="checkbox" class="private"></div></div></form>';return b}a.LabelsComponent=Ember.Component.extend({didInsertElement:function(){this.set("labels",a.User.store.find("label",this._getOpts())),this.set("user",a.User.store.getById("user",currentUser._id))},_getOpts:function(a){return a=a||{},this.get("filterForType")&&(a.type=this.get("filterForType")),a},actions:{removeLabel:function(b){var c=this;bootbox.confirm(Em.I18n.t("label.really_delete",{name:b.get("name")}),function(d){d&&(b.deleteRecord(),b.save().then(function(){c.set("labels",a.User.store.find("label",c._getOpts())),notify("info",Em.I18n.t("label.deleted",{name:b.get("name")}))}).catch(function(a){notify("error",a)}))})},toggleLabel:function(a){this.get("content.labels")&&(this.get("content.labels").findBy("id",a.get("id"))?this.get("content.labels").removeObject(a):this.get("content.labels").pushObject(a))},showLabelContactsOrAddLabel:function(b){if(this.get("controller.selectedContacts.length")>0)this.get("controller.selectedContacts").forEach(function(a){a.get("labels").findBy("id",b.get("id"))?a.get("labels").removeObject(b):a.get("labels").pushObject(b),$("tr[data-id="+a.get("id")+"] td").block(),a.save().then(function(){$("tr[data-id="+a.get("id")+"] td").unblock()})});else{var c=this.get("controller");a.User.store.find("contact",{labels:b.get("id")}).then(function(a){c.set("total",a.get("length")),c.set("contacts",Em.A(a))})}},editLabel:function(c){function d(){var b=$(".bootbox .color.active");b.length||(b=$(".bootbox .color:first").addClass("active")),c.set("bgColor",b.attr("data-bg-color")),c.set("fgColor",b.attr("data-fg-color")),c.set("borderColor",b.attr("data-border-color"));var d=a.User.store.getById("user",currentUser._id);$(".bootbox .private").is(":checked")?c.get("usersAccess").pushObject(d):c.get("usersAccess").removeObject(d),c.set("name",$(".edit-label-modal .name").val()),e()}function e(){var b=c.id?!1:!0;c.save().then(function(c){b?notify("info",Em.I18n.t("label.created",{name:c.get("name")})):notify("info",Em.I18n.t("label.saved",{name:c.get("name")})),h.set("labels",a.User.store.find("label",h._getOpts()))}).catch(function(a){console.error(a),notify("error",a)})}function f(){var a=$(this);a.find("form").on("submit",function(b){b.preventDefault(),d(),a.modal("hide")}),setTimeout(function(){a.find("input[type=text]:first").focus()},500),a.find(".color").on("click",function(){a.find(".color").removeClass("active"),$(this).addClass("active")}),a.find("input[type=checkbox]").attr("checked",c.get("private")),a.find(".color[data-bg-color="+c.get("bgColor")+"]").addClass("active")}function g(){c.isDirty&&c.deleteRecord()}var h=this,i=a.User.store;c||(c=i.createRecord("label",this._getOpts({userAccess:this.get("user")}))),bootbox.dialog({title:Em.I18n.t("name"),message:b(c),className:"edit-label-modal",buttons:{save:{label:Em.I18n.t("save"),className:"primary",callback:d}}}).on("shown.bs.modal",f).on("hide.bs.modal",g)}}})}(App);