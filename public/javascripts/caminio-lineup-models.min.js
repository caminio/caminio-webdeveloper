/*! caminio-lineup 2014-06-27 
* Copyright (c) 2014 <YOUR COMPANY HERE> 
* Available via the MIT license.
* see: http://opensource.org/licenses/MIT for blueprint.
*/
!function(){"use strict";App.LineupEntry=DS.Model.extend({type:DS.attr("string",{defaultValue:"ttp"}),requestReviewBy:DS.belongsTo("user"),requestReviewMsg:DS.attr(),status:DS.attr("string",{defaultValue:"draft"}),translations:DS.hasMany("translation",{embedded:"always"}),categories:DS.attr("array"),lineup_jobs:DS.hasMany("lineup_job",{embedded:"always"}),labels:DS.hasMany("label",{async:!1,embedded:"keys"}),recommendedAge:DS.attr("number"),durationMin:DS.attr("number"),numBreaks:DS.attr("number"),notifyCreatorOnChange:DS.attr("boolean",{defaultValue:!0}),filename:DS.attr("string"),age:DS.attr("number"),lineup_events:DS.hasMany("lineup_event",{embedded:"always",inverse:"lineup_entry"}),ensembles:DS.hasMany("lineup_org",{embedded:"keys"}),organizers:DS.hasMany("lineup_org"),venues:function(){var a=[],b=[];return this.get("lineup_events").forEach(function(c){c.get("lineup_org")&&b.indexOf(c.get("lineup_org.id"))<0&&(a.push(c.get("lineup_org")),b.push(c.get("lineup_org.id")))}),a}.property("lineup_events.@each"),extRefId:DS.attr("string"),extRefSrc:DS.attr("string"),extRefNote:DS.attr("string"),extRefSyncAt:DS.attr("date"),origProjectUrl:DS.attr("string"),videoId:DS.attr("string"),videoIdTransformer:function(){this.get("videoId")&&(this.get("videoId").indexOf("?v=")>0?(this.set("videoId",this.get("videoId").split("?v=")[1]),this.set("videoProvider","youtube")):this.get("videoId").indexOf("vimeo.com/")>=0&&(this.set("videoId",this.get("videoId").split("vimeo.com/")[1]),this.set("videoProvider","vimeo")))}.observes("videoId"),videoProvider:DS.attr("string",{defaultValue:"youtube"}),createdBy:DS.belongsTo("user"),createdAt:DS.attr("date"),updatedBy:DS.belongsTo("user"),updatedAt:DS.attr("date"),othersWrite:DS.attr("boolean",{defaultValue:!0}),notifyMeOnWrite:DS.attr("boolean",{defaultValue:!0}),name:function(){return this.get("title")}.property("title"),usedLocales:function(){var a=this.get("translations").map(function(a){return a.locale}).join(",");return a.length<1?Em.I18n.t("translation.no"):void 0}.property("translations"),isPublished:function(){return"published"===this.get("status")}.property("status"),inReview:function(){return"review"===this.get("status")}.property("status"),isDraft:function(){return"draft"===this.get("status")}.property("status"),curTranslation:function(){return this.get("translations").findBy("locale",App._curLang)}.property("translations.@each","App._curLang"),previewLink:function(){var a="http://"+currentDomain.fqdn+"/drafts/"+this.get("id")+".htm";return this.get("translations").content.length>1&&(a+="."+this.get("curLang")),a}.property("id"),isOwner:function(){return currentUser.superuser||this.get("createdBy.id")===currentUser._id||currentDomain._id in currentUser.roles&&currentUser.roles[currentDomain._id]>=80}.property("createdBy"),isFestival:function(){return this.get("categories").indexOf("festival")>=0}.property("categories")}),Ember.Inflector.inflector.irregular("lineupEntry","lineup_entries")}(App),function(){"use strict";App.LineupEvent=DS.Model.extend({starts:DS.attr("date",{defaultValue:moment().hour(20).minutes(0).seconds(0).toDate()}),lineup_org:DS.belongsTo("lineup_org"),festival:DS.belongsTo("lineup_entry"),lineup_entry:DS.belongsTo("lineup_entry"),premiere:DS.attr("boolean",{defaultValue:!1}),derniere:DS.attr("boolean",{defaultValue:!1}),cancelled:DS.attr("boolean",{defaultValue:!1}),note:DS.attr(),bookPhone:DS.attr(),bookEmail:DS.attr(),bookUrl:DS.attr(),concessions:DS.attr("array"),startsDate:function(a,b){var c=moment(this.get("starts"));return 2===arguments.length&&b.match(/(\d\d\d\d)-(\d\d)-(\d\d)/)&&this.set("starts",moment(b+" "+c.format("HH:mm")).toDate()),moment(this.get("starts")).format("YYYY-MM-DD")}.property("starts"),startsTime:function(a,b){var c=moment(this.get("starts"));return 2===arguments.length&&b.match(/(\d\d):(\d\d)/)&&this.set("starts",moment(c.format("YYYY-MM-DD")+" "+b).toDate()),moment(this.get("starts")).format("HH:mm")}.property("starts")}),Ember.Inflector.inflector.irregular("lineupEvent","lineup_events")}(App),function(){"use strict";App.LineupJob=DS.Model.extend({title:DS.attr("string"),lineup_person:DS.belongsTo("lineup_person"),name:function(){return this.get("lineup_person.name")}.property("lineup_person"),isAuthor:function(){return this.get("title")&&this.get("title").toLowerCase().match(/author|autor|playwright/)}.property("title"),isDirector:function(){return this.get("title")&&this.get("title").toLowerCase().match(/director|regie|regisseur|inszenierung|mis en scene/)}.property("title")}),Ember.Inflector.inflector.irregular("lineupJob","lineup_jobs")}(App),function(){"use strict";App.LineupOrg=DS.Model.extend({type:DS.attr("string",{defaultValue:"venue"}),status:DS.attr("string",{defaultValue:"published"}),translations:DS.hasMany("translation",{embedded:"always"}),curTranslation:function(){return this.get("translations").findBy("locale",App._curLang)}.property("translations.@each"),labels:DS.hasMany("label",{async:!1,embedded:"keys"}),street:DS.attr("string"),zip:DS.attr("string"),city:DS.attr("string"),gkz:DS.attr("string"),country:DS.attr("string",{defaultValue:"AT"}),state:DS.attr("string"),members:DS.hasMany("lineup_person"),origUrl:DS.attr("string"),extRefId:DS.attr("string"),extRefSrc:DS.attr("string"),extRefNote:DS.attr("string"),extRefSyncAt:DS.attr("date"),openingHours:DS.attr("string"),reachByBus:DS.attr("string"),reachByTram:DS.attr("string"),reachByTrain:DS.attr("string"),email:DS.attr("string"),phone:DS.attr("string"),extUrl:DS.attr("string"),videoUrl:DS.attr("string"),videoUrlType:DS.attr("string"),createdBy:DS.belongsTo("user"),createdAt:DS.attr("date"),updatedBy:DS.belongsTo("user"),updatedAt:DS.attr("date"),othersWrite:DS.attr("boolean",{defaultValue:!0}),notifyMeOnWrite:DS.attr("boolean",{defaultValue:!0}),usedLocales:function(){var a=this.get("translations").map(function(a){return a.locale}).join(",");return a.length<1?Em.I18n.t("translation.no"):void 0}.property("translations"),isPublished:function(){return"published"===this.get("status")}.property("status"),isDraft:function(){return"draft"===this.get("status")}.property("status"),isVenue:function(){return"venue"===this.get("type")}.property("type"),isEnsemble:function(){return"ensemble"===this.get("type")}.property("type"),isOrganizer:function(){return"organizer"===this.get("type")}.property("type")}),Ember.Inflector.inflector.irregular("lineupOrg","lineup_orgs")}(App),function(){"use strict";App.LineupPerson=DS.Model.extend({status:DS.attr("string",{defaultValue:"published"}),translations:DS.hasMany("translation",{embedded:"always"}),tags:DS.attr("array"),labels:DS.hasMany("label",{async:!1,embedded:"keys"}),firstname:DS.attr("string"),lastname:DS.attr("string"),midname:DS.attr("string"),email:DS.attr("string"),phone:DS.attr("string"),street:DS.attr("string"),zip:DS.attr("string"),city:DS.attr("string"),gkz:DS.attr("string"),country:DS.attr("string",{defaultValue:"AT"}),state:DS.attr("string"),extRefId:DS.attr("string"),extRefSrc:DS.attr("string"),extRefNote:DS.attr("string"),extRefSyncAt:DS.attr("date"),extUrl:DS.attr("string"),videoUrl:DS.attr("string"),videoUrlType:DS.attr("string"),createdBy:DS.belongsTo("user"),createdAt:DS.attr("date"),updatedBy:DS.belongsTo("user"),updatedAt:DS.attr("date"),othersWrite:DS.attr("boolean",{defaultValue:!0}),notifyMeOnWrite:DS.attr("boolean",{defaultValue:!0}),usedLocales:function(){var a=this.get("translations").map(function(a){return a.locale}).join(",");return a.length<1?Em.I18n.t("translation.no"):void 0}.property("translations"),isPublished:function(){return"published"===this.get("status")}.property("status"),isDraft:function(){return"draft"===this.get("status")}.property("status"),name:function(a,b){b&&(this.set("firstname",b),b.split(" ").length>1&&(this.set("firstname",b.split(" ")[0]),this.set("lastname",b.replace(b.split(" ")[0],""))));var c="";return this.get("firstname")&&this.get("firstname").length>0&&(c+=this.get("firstname")),c.length>0&&this.get("lastname")&&this.get("lastname").length>0&&(c+=" "),this.get("lastname")&&this.get("lastname").length>0&&(c+=this.get("lastname")),c}.property("firstname","lastname"),curTranslation:function(){return this.get("translations").findBy("locale",App._curLang)}.property("translations.@each","App._curLang")}),Ember.Inflector.inflector.irregular("lineupPerson","lineup_people"),Ember.Inflector.inflector.irregular("lineup_person","lineupPeople")}(App),function(a){"use strict";a.Price=DS.Model.extend({name:DS.attr("string"),description:DS.attr("string"),note:DS.attr("string"),limited:DS.attr("number"),price:DS.attr("number"),reductions:DS.hasMany("reduction",{embedded:"always"}),vat:DS.attr("number"),priceIncl:function(){var a=isNaN(this.get("price"))?0:parseFloat(this.get("price")),b=this.get("vat");return console.log("price is",a,b),(a+a*b*.01).toFixed(2)}.property("vat","price"),observeIncl:function(){var a=isNaN(this.get("priceIncl"))?0:this.get("priceIncl"),b=this.get("vat"),c=a/(100+b),d=100*c;console.log("observer vat",b,"perc1",c,"perc100",d),this.set("price",d.toFixed(2))}.observes("priceIncl"),priceExcl:function(){var a=isNaN(this.get("price"))?0:parseFloat(this.get("price"));return a.toFixed(2)}.property("vat","price"),formattedPrice:function(){var b=this.get(a._shopSettings.get("grossInt")?"priceIncl":"priceExcl");return"de"===currentUser.lang&&(b=b.replace(".",",")),new Handlebars.SafeString(b+" "+caminio.util.currencyCode2Symbol(a._shopSettings.get("currency")))}.property("price")}),a.Reduction=a.Price.extend()}(App);